"use strict";function _slicedToArray(t,e){return _arrayWithHoles(t)||_iterableToArrayLimit(t,e)||_unsupportedIterableToArray(t,e)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(a="Object"===a&&t.constructor?t.constructor.name:a)||"Set"===a?Array.from(t):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,r=new Array(e);a<e;a++)r[a]=t[a];return r}function _iterableToArrayLimit(t,e){var a=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=a){var r,n,i=[],o=!0,l=!1;try{for(a=a.call(t);!(o=(r=a.next()).done)&&(i.push(r.value),!e||i.length!==e);o=!0);}catch(t){l=!0,n=t}finally{try{o||null==a.return||a.return()}finally{if(l)throw n}}return i}}function _arrayWithHoles(t){if(Array.isArray(t))return t}var margin={top:12,right:60,bottom:48,left:60},$graphWrapper=d3.select(".graph"),_$graphWrapper$node$g=$graphWrapper.node().getBoundingClientRect(),width=_$graphWrapper$node$g.width,height=_$graphWrapper$node$g.height,innerwidth=width-margin.left-margin.right,innerheight=height-margin.top-margin.bottom,svg=$graphWrapper.append("svg:svg").attr("width",width).attr("height",height).attr("class","svg-plot").append("g").attr("transform","translate(".concat(margin.left,", ").concat(margin.top,")")),x=d3.scaleTime().range([0,innerwidth]),y=d3.scaleLinear().domain([4,28]).range([innerheight,0]),sizeScale=d3.scalePow(),colourScale=(768<width?sizeScale.range([1,6]):sizeScale.range([.5,3]),d3.scaleOrdinal().domain([2015,2016,2017,2018,2019]).range(["#e60049","#0bb4ff","#50e991","#e6d800","#ffa300","#dc0ab4","#b3d4ff","#00bfa0"])),colourScalePastel=d3.scaleOrdinal().domain([2014,2015,2016,2017,2018,2019]).range(d3.schemeBuPu[6]),radius=Math.min(width,height)/2,r=d3.scaleLinear().domain([-4,28]).range([0,radius]),line=d3.lineRadial().radius(function(t){return r(t[1])}).angle(function(t){return-t[0]+Math.PI/2}),xAxis_major=d3.axisBottom(x).tickValues([new Date(2016,0,1),new Date(2017,0,1),new Date(2018,0,1),new Date(2019,0,1)]).tickSize(-innerheight).tickPadding(28).tickFormat(d3.timeFormat("%Y")),xAxis_minor=d3.axisBottom(x).tickSize(-innerheight).tickPadding(6).tickFormat(d3.timeFormat("%b")),yAxis=d3.axisLeft(y).tickSize(12).tickPadding(6).tickValues([4,8,12,16,20,24,28]).tickFormat(function(t,e){return["04:00","08:00","12:00","16:00","20:00","00:00","04:00"][e]}),files=["data/data-2eb912a2cb.csv"],drawRadialGraph=(Promise.all(files.map(function(t){return d3.csv(t)})).then(function(t){var t=_slicedToArray(t,1)[0],e=d3.timeParse("%Y-%m-%d");t.forEach(function(t){t.date=e(t.date),t.hour_num=+t.hour_num,t.words=+t.words}),sizeScale.domain(d3.extent(t,function(t){return t.words})),d3.select(".scrollyteller__stickyScreen").classed("bg--dark",!0),drawRadialGraph(".header__viz",t),drawGraph(".graph",t),svg.selectAll(".dot").classed("hide",!0),xAxis_minor.tickFormat(d3.timeFormat("%d %b %Y")),updateX(new Date(2015,7,24),new Date(2015,8,2))}).then(function(e){var a={step0:function(t){xAxis_minor.tickFormat(d3.timeFormat("%d %b %Y")),updateX(new Date(2015,7,24),new Date(2015,8,2)),svg.selectAll(".dot").classed("hide",!0)},step1:function(t){xAxis_minor.tickFormat(d3.timeFormat("%d %b %Y")),updateX(new Date(2015,7,24),new Date(2015,8,2)),svg.selectAll(".dot").classed("hide",!0),svg.selectAll('.dot[data-id = "firstDay"]').classed("hide",!1),resetAnnotation()},step2:function(t){xAxis_minor.tickFormat(d3.timeFormat("%d %b %Y")),updateX(new Date(2015,7,24),new Date(2015,8,2)),svg.selectAll(".dot").classed("hide",!0),svg.selectAll('.dot[data-id = "firstDay"]').classed("hide",!1),resetAnnotation(),addAnnotation("Eerste bericht op 25 aug 2015 rond 14u30",new Date(2015,7,25),14.5,"left")},step3:function(t){xAxis_minor.tickFormat(d3.timeFormat("%d %b %Y")),updateX(new Date(2015,7,24),new Date(2015,8,2)),svg.selectAll(".dot").classed("hide",!0),svg.selectAll('.dot[data-id = "firstDay"]').classed("hide",!1),resetAnnotation(),addAnnotation("Laat in de avond terug goed aan het sturen",new Date(2015,7,25),23,"left")},step4:function(t){xAxis_minor.tickFormat(d3.timeFormat("%d %b %Y")),updateX(new Date(2015,7,24),new Date(2015,8,2)),svg.selectAll(".dot").classed("hide",!0),svg.selectAll('.dot[data-id = "firstDay"]').classed("hide",!1),resetAnnotation()},step5:function(t){xAxis_minor.tickFormat(d3.timeFormat("%d %b %Y")),updateX(new Date(2015,7,24),new Date(2015,8,2)),svg.selectAll(".dot").classed("hide",!0),svg.selectAll('.dot[data-id = "topDay"]').filter(function(t){return t.day_of_the_year<=245&&2015==t.year}).classed("hide",!1),resetAnnotation()},step6:function(t){xAxis_minor.tickFormat(d3.timeFormat("%b")),updateX(new Date(2015,5,0),new Date(2020,0,0)),resetAnnotation(),svg.selectAll(".dot").classed("hide",!1),svg.selectAll(".dot").attr("fill","rgb(240,255,240)")},step7:function(t){xAxis_minor.tickFormat(d3.timeFormat("%b")),updateX(new Date(2015,5,0),new Date(2020,0,0)),svg.selectAll(".dot").classed("hide",!1),transToLinear(".graph"),svg.selectAll(".dot").attr("fill",function(t){return colourScale(t.year)})},step8:function(t){svg.selectAll(".dot").classed("hide",!1),transToRadial(".graph"),svg.selectAll(".dot").attr("fill",function(t){return colourScale(t.year)})},step9:function(t){svg.selectAll(".dot").classed("hide",!1),d3.select(".scrollyteller__stickyScreen").classed("bg--dark",!0),transToRadial(".graph"),svg.selectAll(".dot").attr("fill",function(t){return colourScalePastel(t.year)})},step10:function(t){svg.selectAll(".dot").classed("hide",!1),d3.select(".scrollyteller__stickyScreen").classed("bg--dark",!1),transToRadial(".graph"),svg.selectAll(".dot").attr("fill",function(t){return colourScalePastel(t.year)})}},r=new IntersectionObserver(function(t){t=t.find(function(t){return t.isIntersecting});t&&(t=t.target.getAttribute("data-id"),a[t](e))},{threshold:.66});document.querySelectorAll(".scrollyteller__movingScreen .scrollyteller__content").forEach(function(t){return r.observe(t)})}),function(t,e){var a=0,r=0,n=d3.select(".header__viz").node().getBoundingClientRect(),i=n.width,o=n.height,l=d3.select(".header__viz").append("canvas").attr("width",i).attr("height",o).style("margin-left",r+"px").style("margin-top",a+"px").attr("class","canvas-plot").node().getContext("2d");e.forEach(function(t){var e;e=line([[reMap((t=t).day_of_the_year),t.hour_num]]).slice(1).slice(0,-1).split(",").map(function(t){return parseInt(t,10)}),l.beginPath(),l.globalAlpha=.4,l.fillStyle=colourScalePastel(t.year),l.arc(e[[0]]+i/2,e[[1]]+o/2,sizeScale(t.words),0,2*Math.PI,!0),l.fill()})}),drawGraph=function(t,e){x.domain([new Date(2015,0,0),new Date(2016,3,0)]),svg.append("line").attr("class","axis axis--midnight").attr("x1",0).attr("x2",innerwidth).attr("y1",function(t){return y(24)}).attr("y2",function(t){return y(24)}),svg.append("g").attr("class","axis axis--x axis--minor").attr("transform","translate(0, ".concat(innerheight,")")).call(xAxis_minor),svg.append("g").attr("class","axis axis--x axis--major").attr("transform","translate(0, ".concat(innerheight,")")).call(xAxis_major),svg.append("g").attr("class","axis axis--y").call(yAxis),svg.append("g").selectAll("dot").data(e).join("circle").attr("class",function(t){return"dot dot__".concat(t.year," dot__white")}).attr("data-id",function(t){return t.type}).attr("date",function(t){return"".concat(t.year).concat(t.day_of_the_year)}).attr("dx",12).attr("cx",function(t){return x(t.date)}).attr("cy",function(t){return y(t.hour_num)}).attr("r",function(t){return sizeScale(t.words)}).attr("fill","rgb(240,255,240)"),d3.selectAll(".axis").selectAll(".domain").remove()},updateX=function(t,e){x.domain([t,e]),svg.selectAll(".axis--x.axis--minor").call(xAxis_minor),svg.selectAll(".axis--x.axis--major").call(xAxis_major),d3.selectAll(".dot").transition().delay(function(t,e){return Math.pow(e,1)/4}).attr("cx",function(t){return x(t.date)}).attr("cy",function(t){return y(t.hour_num)}),d3.selectAll(".axis").selectAll(".domain").remove()},resetAnnotation=function(){svg.selectAll(".annotation").remove()},addAnnotation=function(t,e,a,r){switch(r){case"left":svg.append("line").attr("class","annotation annotation__line").attr("x1",function(t){return x(e)}).attr("x2",function(t){return x(e)+24}).attr("y1",function(t){return y(a)}).attr("y2",function(t){return y(a)}),svg.append("text").attr("class","annotation").attr("dx",6).attr("dy",4).attr("x",function(t){return x(e)+24+12}).attr("y",function(t){return y(a)}).html("".concat(t)).call(wrap,180);break;case"right":svg.append("line").attr("class","annotation annotation__line").attr("x1",function(t){return x(e)}).attr("x2",function(t){return x(e)-24}).attr("y1",function(t){return y(a)}).attr("y2",function(t){return y(a)}),svg.append("text").attr("class","annotation").attr("text-anchor","end").attr("x",function(t){return x(e)-24}).attr("y",function(t){return y(a)}).html("".concat(t)).call(wrap,180)}};function wrap(t,s){t.each(function(){for(var t,e=d3.select(this),a=e.text().split(/\s+/).reverse(),r=[],n=0,i=e.attr("x"),o=e.attr("y"),l=e.text(null).append("tspan").attr("x",i).attr("y",o).attr("dx",-6).attr("dy","0em");t=a.pop();)r.push(t),l.text(r.join(" ")),l.node().getComputedTextLength()>s&&(r.pop(),l.text(r.join(" ")),r=[t],l=e.append("tspan").attr("x",i).attr("y",o).attr("dx",-6).attr("dy",1.4*++n+0+"em").text(t))})}var transToLinear=function(){svg.selectAll(".dot").transition().delay(function(t,e){return.25*e}).attr("cx",function(t){return x(t.date)}).attr("cy",function(t){return y(t.hour_num)}).attr("transform","translate(0,0)"),svg.selectAll(".axis").classed("hide",!1)},transToRadial=function(){svg.selectAll(".dot").transition().delay(function(t,e){return.25*e}).attr("cx",innerwidth/2).attr("cy",innerheight/2).attr("transform",function(t){return"translate("+line([[reMap(t.day_of_the_year),t.hour_num]]).slice(1).slice(0,-1)+")"}),svg.selectAll(".axis").classed("hide",!0)},reMap=function(t){return(t-90)*(2*Math.PI)/-359+0};